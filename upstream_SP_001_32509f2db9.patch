From 32509f2db91a58b9528aeb1bb505e9426b52b825 Mon Sep 17 00:00:00 2001
From: Daid <daid303@gmail.com>
Date: Fri, 25 Jun 2021 11:15:30 +0200
Subject: [PATCH] Add glm library to serious proton, fix android build

---
 CMakeLists.txt               | 22 +++++++++++++++++++++-
 src/io/network/tcpSocket.cpp |  2 ++
 2 files changed, 23 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 184f47d..82a4a87 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -17,6 +17,10 @@ endif()
 # Preflight checks.
 message(STATUS "Crash Logger is " ${ENABLE_CRASH_LOGGER})
 
+set(EXTERNALS_DIR "${PROJECT_BINARY_DIR}/externals")
+set(DOWNLOADS_DIR "${PROJECT_BINARY_DIR}/downloads")
+file(MAKE_DIRECTORY "${EXTERNAL_DIR}" "${DOWNLOADS_DIR}")
+
 if(ENABLE_CRASH_LOGGER)
     if(NOT DRMINGW_ROOT)
         message("Downloading Dr. MinGW")
@@ -81,6 +85,22 @@ if(NOT ${SFML_FOUND})
     )
 endif()
 
+
+find_package(glm QUIET)
+if(NOT ${glm_FOUND})
+    set(GLM_BASE_PATH "${EXTERNALS_DIR}")
+
+    if(NOT EXISTS "${GLM_BASE_PATH}/glm/CMakeLists.txt")
+        set(GLM_ZIP "${DOWNLOADS_DIR}/glm.zip")
+        file(DOWNLOAD "https://github.com/g-truc/glm/releases/download/0.9.9.8/glm-0.9.9.8.zip" "${GLM_ZIP}" TIMEOUT 60 TLS_VERIFY ON)
+
+        file(MAKE_DIRECTORY "${GLM_BASE_PATH}/glm")
+        execute_process(COMMAND ${CMAKE_COMMAND} -E tar -xf "${GLM_ZIP}" WORKING_DIRECTORY "${GLM_BASE_PATH}")
+    endif()
+
+    add_subdirectory("${GLM_BASE_PATH}/glm" "${PROJECT_BINARY_DIR}/glm" EXCLUDE_FROM_ALL)
+endif()
+
 add_subdirectory(src/Box2D)
 add_subdirectory(src/lua)
 add_subdirectory(src/GL)
@@ -192,7 +192,7 @@ target_compile_options(seriousproton_dep
 
 target_link_libraries(seriousproton_deps
     INTERFACE 
-        box2d lua glew ${SFML_LIBRARIES}
+        box2d lua glew ${SFML_LIBRARIES} glm::glm
         "$<$<BOOL:${WIN32}>:wsock32>"
         # LTO flag must be on the linker's list as well.
         "$<$<AND:$<BOOL:${CMAKE_COMPILER_IS_GNUCC}>,$<OR:$<CONFIG:RelWithDebInfo>,$<CONFIG:Release>>>:-flto>"
--
libgit2 1.0.1
